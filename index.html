<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>×ª×™×¢×•×“ ×”×ª×¢×¨×‘×•×™×•×ª/×ª×§×™×¤×•×ª</title>
  <style>
    :root{
      --bg:#f7f8fa; --card:#ffffff; --ink:#1f2a37; --muted:#6b7280;
      --prime:#0b3a6f; --prime-2:#0a2f59; --ring:#e5e7eb; --ok:#155724; --okbg:#d4edda;
      --err:#7f1d1d; --errbg:#fde2e2; --warn:#8a6d3b; --warnbg:#fff3cd;
      --chip:#eef2f7;
    }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.45}
    .banner{background:var(--prime);color:#fff;padding:14px 16px;border-radius:0 0 14px 14px;position:sticky;top:0;z-index:10;box-shadow:0 4px 10px rgba(0,0,0,.06)}
    .banner h1{margin:0;text-align:center;font-size:20px}
    .btn-icon{position:absolute;top:10px;padding:6px 10px;border-radius:8px;border:1px solid rgba(255,255,255,.25);background:rgba(255,255,255,.08);color:#fff;cursor:pointer}
    .btn-icon:hover{background:rgba(255,255,255,.16)}
    .btn-left{left:10px} .btn-right{right:10px}
    .container{max-width:820px;margin:22px auto;padding:0 14px}
    .card{background:var(--card);border:1px solid var(--ring);border-radius:14px;box-shadow:0 2px 8px rgba(0,0,0,.04);padding:18px}
    label>span, legend{font-weight:600}
    input[type="text"],input[type="url"],input[type="date"],select,textarea{
      width:100%;margin-top:6px;padding:10px 12px;border:1px solid #cfd6df;border-radius:8px;font-size:15px;background:#fff;box-sizing:border-box
    }
    textarea{min-height:92px;resize:vertical}
    .hint{display:block;color:var(--muted);font-size:12px;margin-top:4px}
    .grid{display:grid;gap:14px}
    @media(min-width:720px){.cols-2{grid-template-columns:1fr 1fr}.cols-3{grid-template-columns:1fr 1fr 1fr}}
    fieldset{border:1px solid var(--ring);border-radius:10px;padding:12px 12px 8px;margin:0}
    legend{padding:0 6px;font-size:14px;color:var(--prime-2)}
    .checks{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}
    @media(min-width:720px){.checks{grid-template-columns:repeat(3,minmax(0,1fr))}}
    .check{display:flex;align-items:center;gap:8px;background:var(--chip);border:1px solid #e8edf3;padding:6px 8px;border-radius:8px}
    .toolbar{display:flex;gap:8px;margin:6px 0 8px}
    .chipbtn{border:1px solid #cfd6df;background:#f9fbff;border-radius:8px;padding:6px 10px;font-size:13px;cursor:pointer}
    .chipbtn:hover{background:#eef5ff}
    button[type="submit"]{width:100%;padding:12px;border:0;border-radius:10px;background:var(--prime);color:#fff;font-weight:600;cursor:pointer}
    button[type="submit"]:hover{background:var(--prime-2)}
    #responseMessage{display:none;margin-top:12px;padding:10px 12px;border-radius:10px;text-align:center;font-weight:600}
    #responseMessage.success{background:var(--okbg);color:var(--ok);border:1px solid #c3e6cb}
    #responseMessage.error{background:var(--errbg);color:var(--err);border:1px solid #f5c6cb}
    .warning{display:none;margin:12px 0;padding:10px 12px;border-radius:10px;background:var(--warnbg);color:var(--warn);border:1px solid #ffeeba}
    dialog{border:0;border-radius:12px;max-width:520px;width:92%}
    .modal-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
    .close{background:#f2f2f2;border:1px solid #ddd;border-radius:8px;padding:2px 8px;cursor:pointer}
  </style>
</head>
<body>
  <div class="banner">
    <button class="btn-icon btn-left" id="openInfo" title="××™×“×¢">i</button>
    <a href="#" class="btn-icon btn-right" title="××¢×‘×¨ ×œ×˜×‘×œ×ª ×”× ×ª×•× ×™×" target="_blank" rel="noopener">ğŸ“Š</a>
    <h1>×ª×™×¢×•×“ ×”×ª×¢×¨×‘×•×™×•×ª/×ª×§×™×¤×•×ª</h1>
  </div>

  <dialog id="infoModal">
    <div class="modal-head">
      <h3>â„¹ï¸ ××™×š ×××œ××™×?</h3>
      <button class="close" onclick="infoModal.close()">âœ–</button>
    </div>
    <ol>
      <li>×ª××¨×™×š, ×§×™×©×•×¨, ×ª×™××•×¨ ×§×¦×¨.</li>
      <li>×¤×¨×§, ×ª×—×•××™×, ×¤×œ×˜×¤×•×¨××•×ª.</li>
      <li>×›×•×ª×¨×•×ª/×ª×¨×’×•×, ×ª×•×§×£/×™×¢×“, ××™×“×ª ×”×©×¤×¢×”, ×¡×™××•× ×™ ×›×Ÿ/×œ×.</li>
      <li>×©×œ×™×—×”. ×—×•×ª××ª ×–××Ÿ ×ª×ª×•×•×¡×£ ××•×˜×•××˜×™×ª.</li>
    </ol>
  </dialog>

  <div class="container">
    <div id="corsWarning" class="warning"></div>

    <form id="form" class="card" novalidate>
      <input type="hidden" name="timestamp" id="timestampInput"/>

      <div class="grid cols-2">
        <label>
          <span>×ª××¨×™×š</span>
          <input type="date" name="date" id="dateInput" required>
          <small class="hint">×œ× × ×™×ª×Ÿ ×œ×‘×—×•×¨ ×ª××¨×™×š ×¢×ª×™×“×™.</small>
        </label>
        <label>
          <span>×§×™×©×•×¨</span>
          <input type="url" name="link" id="linkInput" required placeholder="https://example.com" pattern="https?://.+">
          <small class="hint">×—×•×‘×” http ××• https.</small>
        </label>
      </div>

      <div class="grid cols-2">
        <label>
          <span>×›×•×ª×¨×ª</span>
          <input type="text" name="title" id="titleInput" placeholder="×›×•×ª×¨×ª ×”××§×•×¨ (×¨×¦×•×™)">
        </label>
        <label>
          <span>×›×•×ª×¨×ª ×‘×¢×‘×¨×™×ª</span>
          <input type="text" name="title_he" id="titleHeInput" placeholder="×ª×¨×’×•×/× ×™×¡×•×— ×‘×¢×‘×¨×™×ª (×œ× ×—×•×‘×”)">
        </label>
      </div>

      <div class="grid cols-2">
        <label>
          <span>×ª×™××•×¨ ×§×¦×¨</span>
          <textarea name="summary" id="summaryInput" required minlength="5" maxlength="500" placeholder="×ª×™××•×¨ ×ª××¦×™×ª×™ ×©×œ ×”××™×¨×•×¢"></textarea>
        </label>
        <label>
          <span>×ª×¨×’×•× ×œ×¢×‘×¨×™×ª</span>
          <textarea name="translation_he" id="translationHeInput" placeholder="×ª×¨×’×•× ×—×•×¤×©×™/× ×§×•×“×•×ª ×‘×¢×‘×¨×™×ª (×œ× ×—×•×‘×”)"></textarea>
        </label>
      </div>

      <div class="grid cols-2">
        <label>
          <span>×”×’×•×£ ×”×ª×•×§×£</span>
          <input type="text" name="attacker" placeholder="××¨×’×•×Ÿ/×’×•×£/×—×©×‘×•×Ÿ">
        </label>
        <label>
          <span>×”×’×•×£ ×”××•×ª×§×£</span>
          <input type="text" name="target" placeholder="××¨×’×•×Ÿ/×’×•×£/×™×¢×“">
        </label>
      </div>

      <fieldset>
        <legend>×¤×¨×§</legend>
        <select name="chapter" id="chapterSelect" required>
          <option value="" selected disabled>×‘×—×¨...</option>
          <option>×“×•×—×•×ª ××—×§×¨</option><option>××§×•××™×ª</option><option>×¢×•×œ××™×ª</option>
          <option>××“×™× ×™×•×ª ×•×¨×’×•×œ×¦×™×”</option><option>×™×•×–××•×ª ××–×¨×—×™×•×ª</option><option>××—×¨</option>
        </select>
      </fieldset>

      <fieldset>
        <legend>×ª×—×•× <span class="hint">×‘×—×™×¨×” ××¨×•×‘×”</span></legend>
        <div class="toolbar">
          <button class="chipbtn" type="button" data-scope="domains" data-action="all">×‘×—×¨ ×”×›×œ</button>
          <button class="chipbtn" type="button" data-scope="domains" data-action="none">× ×§×” ×”×›×œ</button>
        </div>
        <div class="checks" id="domainsBox">
          <label class="check"><input type="checkbox" name="domains[]" value="×›×œ×›×œ×™">×›×œ×›×œ×™</label>
          <label class="check"><input type="checkbox" name="domains[]" value="×¦×‘××™">×¦×‘××™</label>
          <label class="check"><input type="checkbox" name="domains[]" value="×—×‘×¨×ª×™">×—×‘×¨×ª×™</label>
          <label class="check"><input type="checkbox" name="domains[]" value="××“×™× ×™">××“×™× ×™</label>
          <label class="check"><input type="checkbox" name="domains[]" value="×“×ª×™">×“×ª×™</label>
          <label class="check"><input type="checkbox" name="domains[]" value="×¤×•×œ×™×˜×™">×¤×•×œ×™×˜×™</label>
          <label class="check"><input type="checkbox" name="domains[]" value="×‘×™× ×œ××•××™">×‘×™× ×œ××•××™</label>
          <label class="check"><input type="checkbox" name="domains[]" value="×‘×—×™×¨×•×ª">×‘×—×™×¨×•×ª</label>
          <label class="check"><input type="checkbox" name="domains[]" value="××—×¨">××—×¨</label>
          <label class="check"><input type="checkbox" name="domains[]" value="×œ× ×¨×œ×•×•× ×˜×™">×œ× ×¨×œ×•×•× ×˜×™</label>
        </div>
      </fieldset>

      <fieldset>
        <legend>×¤×œ×˜×¤×•×¨××•×ª <span class="hint">×‘×—×™×¨×” ××¨×•×‘×”</span></legend>
        <div class="toolbar">
          <button class="chipbtn" type="button" data-scope="platforms" data-action="all">×‘×—×¨ ×”×›×œ</button>
          <button class="chipbtn" type="button" data-scope="platforms" data-action="none">× ×§×” ×”×›×œ</button>
        </div>
        <div class="checks" id="platformsBox">
          <label class="check"><input type="checkbox" name="platforms[]" value="×¤×™×™×¡×‘×•×§">×¤×™×™×¡×‘×•×§</label>
          <label class="check"><input type="checkbox" name="platforms[]" value="×™×•×˜×™×•×‘">×™×•×˜×™×•×‘</label>
          <label class="check"><input type="checkbox" name="platforms[]" value="××™× ×¡×˜×’×¨×">××™× ×¡×˜×’×¨×</label>
          <label class="check"><input type="checkbox" name="platforms[]" value="×˜×™×§×˜×•×§">×˜×™×§×˜×•×§</label>
          <label class="check"><input type="checkbox" name="platforms[]" value="×˜×•×•×™×˜×¨">×˜×•×•×™×˜×¨</label>
          <label class="check"><input type="checkbox" name="platforms[]" value="×˜×œ×’×¨×">×˜×œ×’×¨×</label>
          <label class="check"><input type="checkbox" name="platforms[]" value="××ª×¨×™× â€ Web">××ª×¨×™× â€ Web</label>
          <label class="check"><input type="checkbox" name="platforms[]" value="×•×•×˜×¡××¤">×•×•×˜×¡××¤</label>
          <label class="check"><input type="checkbox" name="platforms[]" value="×¦'××˜ ×‘×•×˜×™×">×¦'××˜ ×‘×•×˜×™×</label>
          <label class="check"><input type="checkbox" name="platforms[]" value="gaming">gaming</label>
          <label class="check"><input type="checkbox" name="platforms[]" value="×•×•×™×§×™×¤×“×™×”">×•×•×™×§×™×¤×“×™×”</label>
          <label class="check"><input type="checkbox" name="platforms[]" value="×§×¨×™×¤×˜×•">×§×¨×™×¤×˜×•</label>
          <label class="check"><input type="checkbox" name="platforms[]" value="××—×¨">××—×¨</label>
        </div>
      </fieldset>

      <div class="grid cols-3">
        <label>
          <span>××™×“×ª ×”×©×¤×¢×”</span>
          <select name="impact" id="impactSelect" required>
            <option value="× ××•×š">× ××•×š</option>
            <option value="×‘×™× ×•× ×™" selected>×‘×™× ×•× ×™</option>
            <option value="×’×‘×•×”">×’×‘×•×”</option>
            <option value="×§×¨×™×˜×™">×§×¨×™×˜×™</option>
            <option value="×œ× ×¨×œ×•×•× ×˜×™">×œ× ×¨×œ×•×•× ×˜×™</option>
          </select>
        </label>
        <label>
          <span>×©×™××•×© ×‘-AI</span>
          <select name="ai" id="aiSelect" required>
            <option value="×›×Ÿ">×›×Ÿ</option><option value="×œ×" selected>×œ×</option>
          </select>
        </label>
        <label>
          <span>×§×©×•×¨ ×œ-×‘×—×™×¨×•×ª</span>
          <select name="elections" id="electionsSelect" required>
            <option value="×›×Ÿ">×›×Ÿ</option><option value="×œ×" selected>×œ×</option>
          </select>
        </label>
      </div>

      <label>
        <span>×§×©×•×¨ ×œ×™×©×¨××œ/×™×”×•×“×™×</span>
        <select name="israel" id="israelSelect" required>
          <option value="×›×Ÿ">×›×Ÿ</option><option value="×œ×" selected>×œ×</option>
        </select>
      </label>

      <!-- ×”×¢×¨×•×ª ×—×•×¤×©×™×•×ª -->
      <label>
        <span>×”×¢×¨×•×ª</span>
        <textarea name="notes" id="notesInput" placeholder="×”×•×¡×£ ×”×¢×¨×•×ª ×—×•×¤×©×™×•×ª, ×¤×¨×˜×™× × ×•×¡×¤×™×, ×ª×™×•×’×™× ×¤× ×™××™×™× ×•×›×“' (×œ× ×—×•×‘×”)"></textarea>
      </label>

      <button type="submit" id="submitBtn">×©×œ×™×—×”</button>
      <p id="responseMessage"></p>
    </form>
  </div>

  <script>
    // ====== CONFIG ======
    // ×›×ª×•×‘×ª ×”×¤×¨×™×¡×” ×”×—×“×©×”
    const SCRIPT_URL_POST = 'https://script.google.com/macros/s/AKfycbxEXuY6-2gHbaO2N7cws-efoRpHILuPmSiMBT11ovAdezvkq_FyrqFMPsGeZ1kH0e46/exec';

    const isFileOrigin = (location.origin === 'null') || (location.protocol === 'file:');
    const corsWarning = document.getElementById('corsWarning');
    const formEl = document.getElementById('form');
    const responseEl = document.getElementById('responseMessage');

    // modal
    const infoModal = document.getElementById('infoModal');
    document.getElementById('openInfo').addEventListener('click', ()=> infoModal.showModal());

    // file:// warning
    if (isFileOrigin){
      corsWarning.style.display='block';
      corsWarning.innerHTML='âš ï¸ ×”×§×•×‘×¥ ×¤×ª×•×— ×Ö¾<code>file://</code> ×•×œ×›×Ÿ ×”×“×¤×“×¤×Ÿ ×—×•×¡× ×‘×§×©×•×ª. ×¤×ª×— ×“×¨×š ×©×¨×ª (localhost/Pages).';
    }

    // date default + max
    (function(){
      const d=new Date(), yyyy=d.getFullYear(), mm=String(d.getMonth()+1).padStart(2,'0'), dd=String(d.getDate()).padStart(2,'0');
      const today=`${yyyy}-${mm}-${dd}`;
      const dateInput=document.getElementById('dateInput');
      if (dateInput){ dateInput.max=today; if(!dateInput.value) dateInput.value=today; }
    })();

    function showMsg(ok, text){
      responseEl.textContent = text;
      responseEl.className = ok ? 'success' : 'error';
      responseEl.style.display='block';
      responseEl.scrollIntoView({behavior:'smooth', block:'center'});
    }

    function validateForm(){
      responseEl.style.display='none'; responseEl.className='';
      const dateVal = document.getElementById('dateInput').value;
      const linkVal = document.getElementById('linkInput').value.trim();
      const summaryVal = document.getElementById('summaryInput').value.trim();
      const chapterVal = document.getElementById('chapterSelect').value;
      const impactVal = document.getElementById('impactSelect').value;
      const aiVal = document.getElementById('aiSelect').value;
      const electionsVal = document.getElementById('electionsSelect').value;
      const israelVal = document.getElementById('israelSelect').value;

      const today=new Date(); today.setHours(0,0,0,0);
      const picked=new Date(dateVal); picked.setHours(0,0,0,0);

      if(!dateVal){ showMsg(false,'×™×© ×œ××œ× ×ª××¨×™×š.'); return false; }
      if(picked>today){ showMsg(false,'×ª××¨×™×š ×¢×ª×™×“×™ ××™× ×• ××•×ª×¨.'); return false; }
      if(!/^https?:\/\/.+/i.test(linkVal)){ showMsg(false,'×”×§×™×©×•×¨ ×—×™×™×‘ ×œ×”×ª×—×™×œ ×‘-http ××• https.'); return false; }
      if(!summaryVal || summaryVal.length<5){ showMsg(false,'×ª×™××•×¨ ×§×¦×¨ ×§×¦×¨ ××“×™.'); return false; }
      if(!chapterVal){ showMsg(false,'×™×© ×œ×‘×—×•×¨ ×¤×¨×§.'); return false; }
      if(!impactVal || !aiVal || !electionsVal || !israelVal){ showMsg(false,'×™×© ×œ×”×©×œ×™× ××ª ×©×“×•×ª ×›×Ÿ/×œ× ×•××™×“×ª ×”×”×©×¤×¢×”.'); return false; }
      return true;
    }

    // build payload including arrays
    function buildPayload(form){
      const fd=new FormData(form);
      const params=new URLSearchParams();

      for(const [k,v] of fd.entries()){
        if(k.endsWith('[]')) continue;
        params.append(k,v);
      }
      form.querySelectorAll('input[name="domains[]"]:checked').forEach(cb=>params.append('domains[]', cb.value));
      form.querySelectorAll('input[name="platforms[]"]:checked').forEach(cb=>params.append('platforms[]', cb.value));
      return params;
    }

    // Select all / none
    function toggleGroup(scope, action){
      const sel = scope==='domains' ? 'input[name="domains[]"]' : 'input[name="platforms[]"]';
      document.querySelectorAll(sel).forEach(cb => cb.checked = (action==='all'));
    }
    document.querySelectorAll('.chipbtn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        toggleGroup(btn.dataset.scope, btn.dataset.action);
      });
    });

    // submit
    formEl.addEventListener('submit', (e)=>{
      e.preventDefault();
      if(isFileOrigin) return showMsg(false,'××™ ××¤×©×¨ ×œ×©×œ×•×— ××ª×•×š file://. ×¤×ª×— ×“×¨×š http/https.');
      if(!validateForm()) return;

      // client timestamp
      const now=new Date(), pad=n=>String(n).padStart(2,'0');
      const ts=`${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())} ${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;
      document.getElementById('timestampInput').value = ts;

      const payload = buildPayload(formEl);
      const inputs = formEl.querySelectorAll('input, select, textarea, button');
      inputs.forEach(el=>el.disabled=true);

      fetch(SCRIPT_URL_POST, {
        method:'POST',
        mode:'no-cors',
        headers:{'Content-Type':'application/x-www-form-urlencoded;charset=UTF-8'},
        body: payload.toString()
      })
      .then(()=>{ showMsg(true,'âœ… × ×©×œ×—. ×•×•×“× ×©× ×•×¡×¤×” ×©×•×¨×” ×‘×’×™×œ×™×•×Ÿ.'); formEl.reset();
        document.getElementById('dateInput').value = new Date().toISOString().slice(0,10);
      })
      .catch(err=>{ console.error(err); showMsg(false,'âŒ ×©×’×™××” ×‘×©×œ×™×—×”. ×‘×“×•×§ ×—×™×‘×•×¨/×”×¨×©××•×ª/×¤×¨×™×¡×”.'); })
      .finally(()=> setTimeout(()=> inputs.forEach(el=>el.disabled=false), 900));
    });
  </script>
</body>
</html>
